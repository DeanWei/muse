# 调度系统依赖任务测试用例

## 同周期依赖

### 跑一次

1）A(0 0 12 * * ?), B(0 0 13 * * ?)  
A   
|  
B  
任务A每天12点开始跑，任务B每天13点开始跑

2）A(0 0 12 * * ?), B  
A  
|  
B
任务A每天12点开始跑，任务B在A跑完之后马上开始跑

3）A(0 0 12 * * ?), B(0 0 13 * * ?), C  
A  B  
 \/  
 C  
任务A和B每天跑一次，任务C在任务A和B跑完之后就开始跑  
举例：定时任务A和B产生两个表，任务C用到这两个表，产生C表

### 跑多次 
1）A(0 0 1/1 * * ?), B  
A  
|  
B  
任务A每一小时跑一次，任务B在A每次成功之后触发一次。  
举例：小时任务A每小时做一次增量，依赖任务B对A做清洗。

## 不同周期依赖，大周期依赖于小周期

### 前置任务只有一个

1）A(0 0 1/1 * * ?), B(0 30 23 * * ?)  
A  
|  
B  
任务A每小时跑一次，任务B每天23:30开始跑，一定要A当天23次都成功才能开始跑。  
举例：小时任务A每小时做一次增量，依赖任务B每天对所有A做一次merge

2）A(0 0 1/1 * * ?), B(0 0 6/6 * * ?)  
A  
|  
B  
任务A每小时跑一次，任务B每6小时跑一次，依赖于A过去6小时全部成功。  
举例：小时任务A每小时做一次增量，为了提高merge效率，依赖任务B每隔6小时做一次merge

### 前置任务有多个，周期相同

3) A(0 0 1/1 * * ?), B(0 0 1/1 * * ?), C(0 30 23 * * ?)  
A  B  
 \/  
 C   
任务A和B每小时跑一次，任务C每天23:30开始跑，需要当天A和B 23次全部成功才能开始跑。  
举例：任务A和B都是小时任务，每小时做一次增量，任务C每天定点对A和B一天的数据做一次清洗，写入C表。

4) A(0 0 1/1 * * ?), B(0 0 1/1 * * ?), C(0 0 6/6 * * ?)  
A  B  
 \/  
 C   
任务A和B每小时跑一次，任务C每隔6小时跑一次，依赖于A和B过去6小时全部成功。  
举例：任务A和B都是小时任务，每小时做一次增量，任务C每天定点对A和B一天的数据做一次清洗，写入C表。

### 前置任务有多个，周期不同

5) A(0 0 1/1 * * ?), B(0 0 2/2 * * ?), C(0 30 23 * * ?)  
A  B  
 \/  
 C   
任务A每小时跑一次，任务B每两小时跑一次，任务C每天23:30开始跑，依赖任务A一天23次全部成功，依赖B一天12次全部成功。  
举例：任务A每小时做一次增量，任务B数据量不是很大或者因为业务需求，每2小时做一次增量。任务C同时用到A和B的数据。

6）A(0 0 1/1 * * ?), B(0 0 2/2 * * ?), C(0 0 6/6 * * ?)  
A  B  
 \/  
 C   
任务A每小时跑一次，任务B每两小时跑一次，任务C每6小时跑一次，依赖于A和B过去6小时任务全部成功。  
举例：任务A每小时做一次增量，任务B数据量不是很大或者因为业务需求，每2小时做一次增量。任务C同时用到A和B的数据。

### 前置任务有多个变种

前置任务有多个，且前置任务一天跑多次的情况比较复杂，可以通过依赖配置变种成用例1和3的组合。  
比如说把用例5变种=>加入临时表A'(0 30 23 * * ?), 临时表B'(0 30 23 * * ?)  
A   B  
|   |   
A'  B'  
\ /  
 C    
通过这种对前置任务有多个，且周期小于一天一次的情况，可以通过这种变种，减少依赖检测的复杂性。这种变种对用例3、4、5、6都适用。



## 不同周期依赖，小周期依赖于大周期

这种情况比较是需要配置偏移策略，比如B依赖于A过去三天的数据，过去一周的数据等。

## 不同版本的依赖
对上面的依赖，都需要考虑上一天任务失败，对下一天的影响

